KISSY.add("components/album_manage_project/index",function(a,b,c,d){var e=a.all,f=32,g=b.extend({bindUI:function(){var b=this;b.showProjectIcons();e(".icons-container");b.pagelet.ready(function(){var c=b.pagelet.getBrick("J_slider"),d=e("#J_cur_size");c.on("drag",function(b){var c=e(".icons-container .svg-box"),g=b.current,h=g/f;d.html(g+"px"),a.each(c,function(a){var a=e(a),b=a.attr("data-width")*h,c=a.attr("data-height")*h;a.css({width:b,height:c}),a.one("svg").attr({width:b,height:c})[0].setAttribute("viewBox","0 0 "+b+" "+c)}),c.all(".transform-group").attr("transform","scale("+h+", "+h+")")})}),b.bindEvent()},bindEvent:function(){var b=this;a.one(window).on("popstate",function(){b.showProjectIcons()},!1)},showProjectDialog:function(a){var b=c.showDialog({width:482,height:500,elCls:"med-dialog",data:a,tmpl:'<div class="project_detail" bx-name="album_dialog_pro_msg" bx-path="components/album_dialog_pro_msg/"></div>'});return b},showProjectTransferDialog:function(){var a=c.showDialog({width:482,height:230,elCls:"med-dialog",tmpl:'<div class="project_detail" bx-name="album_dialog_transfer" bx-path="components/album_dialog_transfer/"></div>'});return a},operateCar:function(a){var b=e("#J_car");a.hasClass("selected")?c.removeAnim(a,b):c.addAnim(a,b)},initClip:function(){e(".clipboard").each(function(){var b=(a.unEscapeHTML(a.one(this).html()),a.one(this)[0]),c=new ZeroClipboard(b,{moviePath:"/ZeroClipboard.swf",forceHandCursor:!0});c.on("complete",function(){alert("unicode已复制到剪贴板")})})},initSwitch:function(){var b=this;a.all(".ks-switch .has-switch label").on("click",function(c){var d=a.one(c.target);d.hasClass("switch-left")?(d.parent(".has-switch").removeClass("switch-off").addClass("switch-on"),a.one("#list_container").removeClass("show-fontclass")):(d.parent(".has-switch").removeClass("switch-on").addClass("switch-off"),a.one("#list_container").addClass("show-fontclass")),e(".online_list").slideDown(.5),setTimeout(function(){b.get("isHover")||e(".online_list").slideUp(.1)},1500)}),a.all(".ks-switch .has-switch .switch-key").on("click",function(c){var d=a.one(c.target),f=d.parent(".has-switch");f.hasClass("switch-on")?(f.removeClass("switch-on").addClass("switch-off"),a.one("#list_container").addClass("show-fontclass")):(f.removeClass("switch-off").addClass("switch-on"),a.one("#list_container").removeClass("show-fontclass")),e(".online_list").slideDown(.5),setTimeout(function(){b.get("isHover")||e(".online_list").slideUp(.1)},1500)})},showProjectIcons:function(){var b=a.unparam(location.search.replace(/^\?/,"")),c=null;c=b.pid?b.pid:e(".left .selected").attr("data-pid"),c&&this.getProjectIcons(c)},getProjectIcons:function(b){var f=this;f.set("pid",b),a.io({url:"/api/"+c.ApiVersion+"/projects/"+b,type:"get",dataType:"json",headers:{"X-CSRF-Token":e('meta[name="csrf-token"]').attr("content")},success:function(g){f.set("currentProject",{owner:g.owner,users:g.users,project:g.project});var h=e("#list_container"),i=e("#list_tpl").html(),j=new d(i,{commands:{showUnicode:function(a,b){return parseInt(b.params[0]).toString(16)},escapeJSON:function(b,c){return a.escapeHTML(JSON.stringify(c.params[0]))},renderSvg:function(a,b){return c.renderSvg(b.params[0])}}});g.isOwner=userId==g.owner.id,g.usersCount=g.users.length,g.members=g.users.slice(0,3),g.otherMembers=g.users.slice(3);var k=j.render(g);h.html(k),c.animBtn(),c.renderShopSelected(),f.initClip(),f.initSwitch(),e('.icons-container .left li[data-pid="'+b+'"]').addClass("selected").siblings("li").removeClass("selected")},error:c.ApiErrorFn})},pushState:function(a){window.history&&window.history.pushState&&history.pushState(null,document.title,a)}},{ATTRS:{isHover:{value:!1}},EVENTS:{".icon":{click:function(a){var b=this,c=e(a.currentTarget);b.operateCar(c)}},"#J_online":{mouseenter:function(){var a=this;a.set("isHover",!0),e(".online_list").slideDown(.5)},mouseleave:function(){var a=this;a.set("isHover",!1),setTimeout(function(){a.get("isHover")||e(".online_list").slideUp(.1)},300)}},".J_code_pannel":{click:function(b){var c=!1,d=e(b.currentTarget)[0],f=a.one("#J_pannel_msg");d.select();try{c=document.execCommand("copy")}catch(g){}c?f.html("代码已成功复制到剪贴板").fadeIn():f.html("您当前的浏览器不支持复制，请手动复制").fadeIn(),a.later(function(){f.fadeOut()},1e3)}},".online_list":{mouseenter:function(){var a=this;a.set("isHover",!0)},mouseleave:function(){var a=this;a.set("isHover",!1),setTimeout(function(){a.get("isHover")||e(".online_list").slideUp(.1)},300)}},".shopcar":{click:function(a){a.preventDefault();var b=this,c=e(a.currentTarget),d=e(c.parent().siblings(".icon"));b.operateCar(d)}},".transfer":{click:function(){var a=this;c.confirm("转让后你就不再是该项目的所有者了，确认要进行转让吗？",function(){a.showProjectTransferDialog()})}},".edit":{click:function(){var a=this;a.showProjectDialog(a.get("currentProject"))}},".info":{click:function(){var b=this,c=a.clone(b.get("currentProject"));c.disable=!0,b.showProjectDialog(c)}},".delete":{click:function(b){var d=e(b.currentTarget),f=d.parent().attr("data-pid");c.confirm("确认要删除项目吗？",function(){a.io({url:"/api/"+c.ApiVersion+"/projects/"+f,type:"post",async:!1,dataType:"json",data:{_method:"delete"},headers:{"X-CSRF-Token":e('meta[name="csrf-token"]').attr("content")},success:function(){location.href="/showProject"},error:c.ApiErrorFn})})}},".download":{click:function(b){b.preventDefault();var d=e(b.currentTarget),f=d.attr("data-icon");f=a.JSON.parse(a.unEscapeHTML(f));var g=a.merge(f,{pid:d.attr("data-pid")});c.showDownloadDialog(g)}},".editIcon":{click:function(b){var d=this;b.preventDefault();var f=e(b.currentTarget),g=f.attr("data-msg");g=a.JSON.parse(g),g.pid=d.get("pid"),c.showEditiconDialog(g)}},".like":{click:function(a){a.preventDefault();var b=e(a.currentTarget),d=b.parent().attr("data-iconid");b.hasClass("selected")?c.removeLike(d,b):c.addLike(d,b)}},".destroy":{click:function(b){b.preventDefault();var d=e(b.currentTarget),f=e(".left .selected").attr("data-pid"),g=d.parent().attr("data-iconid"),h=function(){a.io({url:"/icons/"+g+"/deleteIconFromProject",type:"post",async:!1,data:{pid:f},headers:{"X-CSRF-Token":e('meta[name="csrf-token"]').attr("content")},dataType:"json",success:function(a){a.isok?e(".font_"+g).fadeOut(.1):c.alert(a.info)}})};c.confirm("您确定要把这个图标从项目库中删除吗？",h)}},".left li":{click:function(a){var b=this;a.preventDefault();var c=e(a.currentTarget),d=c.attr("data-pid");c.hasClass("selected")||(b.pushState(location.pathname+"?pid="+d),b.showProjectIcons())}},"#J_generate_links":{click:function(b){b.preventDefault(),c.info("正在生成在线链接，请稍候");var d=e(b.currentTarget),f=d.attr("data-pid");a.io({url:"/api/"+c.ApiVersion+"/projects/"+f+"/generate_font",type:"post",headers:{"X-CSRF-Token":e('meta[name="csrf-token"]').attr("content")},dataType:"json",success:function(){window.location.reload()},error:c.ApiErrorFn})}},"#J_generate_new_line":{click:function(b){b.preventDefault(),c.info("正在分析解决基线问题，请稍候...");var d=e(b.currentTarget),f=d.attr("data-pid");a.io({url:"/projects/"+f+"/changeProjectIconLine",type:"post",headers:{"X-CSRF-Token":e('meta[name="csrf-token"]').attr("content")},dataType:"json",success:function(){window.location.reload()},error:c.ApiErrorFn})}}}});return g},{requires:["brix/core/brick","components/custom_helper/","xtemplate"]});