!function(){function a(a){return a instanceof HTMLElement||a instanceof SVGElement}function b(b){if(!a(b))throw new Error("an HTMLElement or SVGElement is required; got "+b)}function c(a){return a&&0==a.lastIndexOf("http",0)&&-1==a.lastIndexOf(window.location.host)}function d(a,d){b(a);var e=a.querySelectorAll("image"),f=e.length,g=function(){0===f&&d()};g();for(var h=0;h<e.length;h++)!function(a){var b=a.getAttributeNS("http://www.w3.org/1999/xlink","href");if(b&&c(b.value))return void console.warn("Cannot render embedded images linking to external hosts: "+b.value);var d=document.createElement("canvas"),e=d.getContext("2d"),h=new Image;b=b||a.getAttribute("href"),b?(h.src=b,h.onload=function(){d.width=h.width,d.height=h.height,e.drawImage(h,0,0),a.setAttributeNS("http://www.w3.org/1999/xlink","href",d.toDataURL("image/png")),f--,g()},h.onerror=function(){console.log("Could not load "+b),f--,g()}):(f--,g())}(e[h])}function e(a,b){for(var c="",d=document.styleSheets,e=0;e<d.length;e++){try{var f=d[e].cssRules}catch(g){console.warn("Stylesheet could not be loaded: "+d[e].href);continue}if(null!=f)for(var h=0;h<f.length;h++){var i=f[h];if("undefined"!=typeof i.style){var j,k;try{k=i.selectorText}catch(l){console.warn('The following CSS rule has an invalid selector: "'+i+'"',l)}try{k&&(j=a.querySelector(k))}catch(l){console.warn('Invalid CSS selector "'+k+'"',l)}if(j){var m=b?b(i.selectorText):i.selectorText;c+=m+" { "+i.style.cssText+" }\n"}else i.cssText.match(/^@font-face/)&&(c+=i.cssText+"\n")}}}return c}function f(a,b,c){var d=a.viewBox&&a.viewBox.baseVal&&a.viewBox.baseVal[c]||null!==b.getAttribute(c)&&!b.getAttribute(c).match(/%$/)&&parseInt(b.getAttribute(c))||a.getBoundingClientRect()[c]||parseInt(b.style[c])||parseInt(window.getComputedStyle(a).getPropertyValue(c));return"undefined"==typeof d||null===d||isNaN(parseFloat(d))?0:d}function g(a){return a=encodeURIComponent(a),a=a.replace(/%([0-9A-F]{2})/g,function(a,b){var c=String.fromCharCode("0x"+b);return"%"===c?"%25":c}),decodeURIComponent(a)}function h(a,b){var c=document.createElement("a");c.download=a,c.href=b,document.body.appendChild(c),c.addEventListener("click",function(){c.parentNode.removeChild(c)}),c.click()}var i="undefined"!=typeof exports&&exports||"undefined"!=typeof define&&{}||this,j='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';i.svgAsDataUri=function(a,c,h){b(a),c=c||{},c.scale=c.scale||1;var i="http://www.w3.org/2000/xmlns/";d(a,function(){var b,d,k=document.createElement("div"),l=a.cloneNode(!0);if("svg"==a.tagName)b=c.width||f(a,l,"width"),d=c.height||f(a,l,"height");else{if(!a.getBBox)return void console.error("Attempted to render non-SVG element",a);var m=a.getBBox();b=m.x+m.width,d=m.y+m.height,l.setAttribute("transform",l.getAttribute("transform").replace(/translate\(.*?\)/,""));var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.appendChild(l),l=n}l.setAttribute("version","1.1"),l.getAttribute("xmlns")||l.setAttributeNS(i,"xmlns","http://www.w3.org/2000/svg"),l.getAttribute("xmlns:xlink")||l.setAttributeNS(i,"xmlns:xlink","http://www.w3.org/1999/xlink"),l.setAttribute("width",b*c.scale),l.setAttribute("height",d*c.scale),l.setAttribute("viewBox",[c.left||0,c.top||0,b,d].join(" ")),k.appendChild(l);var o=e(a,c.selectorRemap),p=document.createElement("style");p.setAttribute("type","text/css"),p.innerHTML="<![CDATA[\n"+o+"\n]]>";var q=document.createElement("defs");q.appendChild(p),l.insertBefore(q,l.firstChild);var n=j+k.innerHTML,r="data:image/svg+xml;base64,"+window.btoa(g(n));h&&h(r)})},i.svgAsPngUri=function(a,c,d){b(a),i.svgAsDataUri(a,c,function(a){var b=new Image;b.onload=function(){var a=document.createElement("canvas");a.width=b.width,a.height=b.height;var e=a.getContext("2d");c&&c.backgroundColor&&(e.fillStyle=c.backgroundColor,e.fillRect(0,0,a.width,a.height)),e.drawImage(b,0,0);{var f;document.createElement("a")}try{f=a.toDataURL("image/png")}catch(g){if("undefined"!=typeof SecurityError&&g instanceof SecurityError||"SecurityError"==g.name)return void console.error("Rendered SVG images cannot be downloaded in this browser.");throw g}d(f)},b.onerror=function(a){console.error("There was an error loading the data URI as an image",a)},b.src=a})},i.saveSvg=function(a,c,d){b(a),d=d||{},i.svgAsDataUri(a,d,function(a){h(c,a)})},i.saveSvgAsPng=function(a,c,d){b(a),d=d||{},i.svgAsPngUri(a,d,function(a){h(c,a)})},"undefined"!=typeof define&&define(function(){return i})}(),KISSY.add("components/album_dialog_download/index",function(a,b,c,d,e,f){var g=a.all,h="@TEMPLATE|"+Brix.absoluteFilePath(this,"template.html")+"|TEMPLATE@",i=b.extend({bindUI:function(){var b=this,d=this.pagelet.get("data");d.icon_svg=c.renderSvg(a.merge(d,{size:200,color:"#272636"})),b.setChunkData("icon",d),this.renderdata=d,b.bind()},_changeColor:function(a){var b=this;g(".preview .svg-box path").attr("fill",a),g("#J_input_color").val(a.substring(1)),g("#J_preview_color").css("background-color",a),b.updateDownloadURL({color:a.substring(1)})},bind:function(){var b=this,h="272636",i="200";g("#J_input_color").on("valuechange",function(){var c="#"+g("#J_input_color").val(),d=a.one(".size-combobox-input").val();g(".preview .svg-box path").attr("fill",c),g("#J_preview_color").css("background-color",c),b.updateDownloadURL({color:c.substring(1),size:d})});var j=new d({trigger:"#J_preview_color",align:{node:"#J_preview_color",points:["br","bl"],offset:[0,0]}});j.on("selected",function(a){var c=a.hex;b._changeColor(c)}),c.dialog&&c.dialog.on("hide",function(){j&&j.destroy()});var k=new e({render:"#size-input",dataSource:new e.LocalDataSource({data:["16","32","64","128"]}),width:62,prefixCls:"size-",hasTrigger:!1,maxItemCount:12});k.render(),k.get("input").on("focus",function(){k.sendRequest("")}),k.on("click",function(a){var c=a.target;f.set("dl_size",parseInt(c.get("value"))),b.updateDownloadURL({size:parseInt(c.get("value"))})}),a.one("#size-dropdown").on("click",function(){k.sendRequest("")}),a.one(".size-combobox-input").on("blur",function(){f.set("dl_size",a.one(".size-combobox-input").val()),b.updateDownloadURL({size:a.one(".size-combobox-input").val()})}),b._changeColor("#"+h),a.one(".size-combobox-input").val(f.get("dl_size")||i),b.updateDownloadURL({color:h,size:f.get("dl_size")||i})},updateDownloadURL:function(b){return!a.isObject(b)||a.isEmptyObject(b)?!1:(b.color&&(this.color=b.color),void(b.size&&(this.size=b.size)))}},{ATTRS:{tmpl:{value:h}},EVENTS:{".pick_color":{click:function(a){var b=this,c=g(a.currentTarget),d=c.attr("data-color");b._changeColor(d)}},".J_download_icon_svg":{click:function(b){g(b.currentTarget);b.preventDefault();var d=c.renderSvg(a.merge(this.renderdata,{size:this.size,color:"#"+this.color})),e=this.size/this.renderdata.height,f=this.renderdata.name+".svg";saveSvg(KISSY.one(d).one("svg")[0],f,{width:this.renderdata.width*e,height:this.renderdata.height*e})}},".J_download_icon_png":{click:function(b){g(b.currentTarget);b.preventDefault();var d=c.renderSvg(a.merge(this.renderdata,{size:this.size,color:"#"+this.color})),e=this.size/this.renderdata.height,f=this.renderdata.name+".png";saveSvgAsPng(KISSY.one(d).one("svg")[0],f,{width:this.renderdata.width*e,height:this.renderdata.height*e})}},".J_download_icon_eps":{click:function(b){b.preventDefault();var c="/uploads/fonts/font-"+this.renderdata.id+"-"+(this.renderdata.pid||"")+".eps";c+="?"+a.param({color:this.color,size:this.size}),window.open(c)}}}});return i},{requires:["brix/core/brick","components/custom_helper/","brix/gallery/colorpicker/","combobox","cookie","brix/gallery/colorpicker/index.css"]});