!function(t,e,n,i){function r(){}function s(){}function o(n,i,r){function o(){u.parentNode&&u.parentNode.removeChild(u),t[p]=s,l&&clearTimeout(l)}function a(){t[p]&&o()}"function"==typeof i&&(r=i,i={}),i||(i={});var u,l,c=i.prefix||"__jp",f=i.param||"_callback",h=null!==i.timeout?i.timeout:6e4,d=encodeURIComponent,m=e.getElementsByTagName("script")[0]||e.head,p=c+v++;return h&&(l=setTimeout(function(){o(),r&&r(new Error("Timeout"))},h)),t[p]=function(t){o(),r&&r(null,t)},n+=(~n.indexOf("?")?"&":"?")+f+"="+d(p),n=n.replace("?&","?"),u=e.createElement("script"),u.src=n,m.parentNode.insertBefore(u,m),a}var a=function(){var t={},e=Object.prototype.hasOwnProperty,n=Array.prototype.slice,r=Object.prototype.toString,s=Function.prototype.bind,o=Object.keys,a=Array.prototype.reduce,u=function(t,e,n){if(void 0===e)return t;switch(null===n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,s){return t.call(e,n,i,r,s)}}return function(){return t.apply(e,arguments)}},l=function(){};t.each=t.forEach=function(e,n,i){if(null===e)return e;n=u(n,i);var r,s=e.length;if(s===+s)for(r=0;s>r;r++)n(e[r],r,e);else{var o=t.keys(e);for(r=0,s=o.length;s>r;r++)n(e[o[r]],o[r],e)}return e},t.bind=function(e,i){var r,o;if(s&&e.bind===s)return s.apply(e,n.call(arguments,1));if(!t.isFunction(e))throw new TypeError("Bind must be called on a function");return r=n.call(arguments,2),o=function(){if(!(this instanceof o))return e.apply(i,r.concat(n.call(arguments)));l.prototype=e.prototype;var s=new l;l.prototype=null;var a=e.apply(s,r.concat(n.call(arguments)));return t.isObject(a)?a:s}},t.keys=function(e){if(!t.isObject(e))return[];if(o)return o(e);var n=[];for(var i in e)t.has(e,i)&&n.push(i);return n},t.has=function(t,n){return null!==t&&e.call(t,n)},t.isArray=Array.isArray||function(t){return"[object Array]"===r.call(t)},t.isFunction=function(t){return"function"==typeof t||!1},t.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},t.indexOf=function(e,n,i){if(null===e)return-1;var r=0,s=e.length;if(i){if("number"!=typeof i)return r=t.sortedIndex(e,n),e[r]===n?r:-1;r=0>i?Math.max(0,s+i):i}for(;s>r;r++)if(e[r]===n)return r;return-1},t.extend=function(n){if(!t.isObject(n))return n;for(var i,r,s=1,o=arguments.length;o>s;s++){i=arguments[s];for(r in i)e.call(i,r)&&(n[r]=i[r])}return n},t.heredoc=function(t){return t.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"").replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},f=function(e){var n=function(t){return e[t]},i="(?:"+t.keys(e).join("|")+")",r=RegExp(i),s=RegExp(i,"g");return function(t){return t=null===t?"":""+t,r.test(t)?t.replace(s,n):t}};t.escape=f(c),t.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var h=/\\|'|\r|\n|\u2028|\u2029/g,d={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},m=function(t){return"\\"+d[t]},p=/(.)^/;return t.template=function(e,n){var i=t.templateSettings,r=RegExp([(i.escape||p).source,(i.interpolate||p).source,(i.evaluate||p).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(r,function(t,n,i,r,a){return o+=e.slice(s,a).replace(h,m),s=a+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":r&&(o+="';\n"+r+"\n__p+='"),t}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(i.variable||"obj","_",o)}catch(u){throw u.source=o,u}var l=function(e){return a.call(this,e,t)},c=i.variable||"obj";return l.source="function("+c+"){\n"+o+"}",n?l(n):l},t.dasherize=function(t){return t.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()})},t.capitalize=function(t){return t.replace(/^([a-z])/,function(t,e){return e.toUpperCase()})},t.camelize=function(t){return t.replace(/-([a-z])/g,function(t,e){return e.toUpperCase()})},t.map=function(e,n,r){var s=[];return null===e||e===i?s:e.map===Array.prototype.map?e.map(n,r):(t.each(e,function(t,e,i){s.push(n.call(r,t,e,i))}),s)},t.reduce=function(e,n,i,r){return a&&e.reduce===a?e.reduce(t.bind(n,r),i):(t.each(e,function(t,e,s){i=n.call(r,i,t,e,s)}),i)},t.param=function(e){return e?t.map(e,function(t,e){return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&"):void 0},t.last=function(t){return t[t.length-1]},t}(),u="div",l={CLASS_NAME:"muxfb-dialog",PANEL_SELECTOR:".muxfb-dialog-panel",CONTENT_SELECTOR:".muxfb-dialog-content",MASK_SELECTOR:".muxfb-dialog-mask",CLOSE_CLASS_NAME:"muxfb-dialog-close"},c={IFRAME_NAME:"muxfb-uploader-iframe"},f={SUBMIT_FORM:"http://fb.alimama.com/jsonp/feedback/create",GET_FORM:"http://fb.alimama.com/jsonp/form/",GET_LIST:"http://fb.alimama.com/jsonp/feedback",UPLOAD_IMAGE:"http://fb.alimama.com/jsonp/upload",UN_READ:"http://fb.alimama.com/jsonp/feedback/unread"},h={TIP:'    <div class="muxfb-global-tip">\n        <i id="muxfb-global-tip-close" class="muxfb-global-tip-close"></i>\n        \u60a8\u53ef\u4ee5\u901a\u8fc7\u70b9\u51fb<i class="muxfb-icon muxfb-icon-feedback"></i>\n        <div class="msg">\u5bf9\u6211\u4eec\u4ea7\u54c1\u7684<em>\u4f53\u9a8c\u3001\u529f\u80fd\u3001\u7cfb\u7edf\u9519\u8bef</em>\u7b49\u63d0\u51fa\u53cd\u9988\uff0c\u4ee5\u5e2e\u52a9 \u6211\u4eec\u6539\u5584\u4ea7\u54c1\u4f53\u9a8c\uff0c\u4e3a\u60a8\u63d0\u4f9b\u66f4\u597d\u7684\u670d\u52a1\uff01</div>\n        <div class="muxfb-global-tip-bottom">\n            <span id="muxfb-global-emitter">\u7acb\u5373\u53cd\u9988</span>\n        </div>\n    </div>\n',LIST:'            <div class="muxfb-list-title">\u6211\u63d0\u4ea4\u7684\u53cd\u9988</div>\n\n            <% if(feedbacks.length > 0){ %>\n                <ul  class="muxfb-fb-lists">\n                    <% for (var i = 0; i < feedbacks.length; i++) { %>\n                    <li class="muxfb-fb-detail">\n                        <pre class="muxfb-detail-content"><%- feedbacks[i].description %></pre>\n                        <div class="muxfb-detail-bottom">\n                            <% if(feedbacks[i].image && feedbacks[i].image.length > 0){ %>\n                                <% for (var j = 0; j < feedbacks[i].image.length; j++) { %>\n                                    <span class="muxfb-detail-bottom-img">\n                                        <i class="muxfb-icon muxfb-icon-image"></i>\n                                        <a href="<%- feedbacks[i].image[j] %>" target="_blank">\u622a\u56fe</a>\n                                    </span>\n                                <% } %>\n                            <% } %>\n\n                            <span class="muxfb-detail-bottom-date"><%- feedbacks[i].createAt %></span>\n                        </div>\n                        <% if(feedbacks[i].message.length){ %>\n                        <div class="muxfb-detail-reply-wrap">\n                            <% for (var m = 0; m < feedbacks[i].message.length; m++) { %>\n                            <div class="muxfb-detail-reply">\n                                <span class="muxfb-detail-reply-left">[\u56de\u590d]\uff1a</span><pre><%- feedbacks[i].message[m].content %></pre>\n                            </div>\n                            <% } %>\n                        </div>\n                        <% } %>\n                    </li>\n\n                    <% } %>\n                </ul>\n            <% }else{ %>\n                <div class="muxfb-lists-unread">\n                    <i class="muxfb-icon muxfb-icon-smile"></i>\n                    <span class="muxfb-lists-message">\u60a8\u8fd8\u6ca1\u6709\u63d0\u4ea4\u8fc7\u53cd\u9988\u54e6\uff01</span>\n                </div>\n            <% } %>\n\n        ',FORM:'            <div class="muxfb-left-tab-wrap">\n                <div class="muxfb-left-logo" >\n                    <i class="muxfb-icon muxfb-icon-logo"></i>\n                    <span class="title">\u4e94\u5f69\u77f3\u7814\u7a76\u5ba4</span>\n                </div>\n                <ul>\n                    <li class="muxfb-left-tab current"><a href="javascript:void(0)">\u6211\u8981\u53cd\u9988\u95ee\u9898</a></li>\n                    <li class="muxfb-left-tab">\n                        <a id="J_tab_fb_list" href="javascript:void(0)">\u7ba1\u7406\u95ee\u9898<% if (unreadCount) { %><em class="g-unread-em"><%- unreadCount %></em><% } %></a>\n                    </li>\n                </ul>\n            </div>\n            <div class="muxfb-right-content muxfb-form">\n                <h1 class="muxfb-form-title"><%- title %></h1>\n                <div class="muxfb-tabs">\n                    <% if (card.length > 1) { %>\n                        <ul class="muxfb-tabs-bar">\n                            <% for (var i = 0; i < card.length; i++) { %>\n                                <% if (i === 0) { %>\n                                    <li><label><input type="radio" name="muxfb-form-radio" checked /><%- card[i].title %></label></li>\n                                <% } else { %>\n                                    <li><label><input type="radio" name="muxfb-form-radio" /><%- card[i].title %></label></li>\n                                <% } %>\n                            <% } %>\n                        </ul>\n                    <% } %>\n                    <% for (var i = 0; i < card.length; i++) { %>\n                        <div class="muxfb-tabs-panel">\n                            <% if (card[i].grade) { %>\n                                <ul>\n                                    <% for (var j = 0; j < card[i].field.length; j++) { %>\n                                        <li class="muxfb-star"></li>\n                                    <% } %>\n                                </ul>\n                            <% } %>\n                            <% if (card[i].enabledProblemTemplate) { %>\n                                <select class="muxfb-question-category">\n                                    <option value ="">\u8bf7\u9009\u62e9\u95ee\u9898\u7c7b\u578b</option>\n                                    <% for (var m = 0; m < card[i].problemTemplate.length; m++) { %>\n                                        <option value ="<%- card[i].problemTemplate[m].content %>"><%- card[i].problemTemplate[m].title %></option>\n                                    <% } %>\n                                </select>\n                            <% } %>\n                            <textarea class="muxfb-form-textarea" placeholder="\u60a8\u7684\u53cd\u9988\u5bf9\u6211\u4eec\u6765\u8bf4\u5f88\u91cd\u8981^.^"></textarea>\n\n                        </div>\n                    <% } %>\n                </div>\n                <% if (notie8) { %>\n                <div class="muxfb-uploader">\n                    <form class="muxfb-uploader-input" enctype="multipart/form-data" method="post">\n                        <i class="muxfb-icon muxfb-icon-image"></i>\n                        \u6dfb\u52a0\u622a\u56fe\n                        <input type="file" name="img" />\n                    </form>\n                    <ul class="muxfb-uploader-preview">\n                    </ul>\n                </div>\n                <% } %>\n                <div class="muxfb-form-message">\n                </div>\n                <div class="muxfb-form-btns">\n                    <button class="muxfb-form-submit">\u63d0\u4ea4</button>\n                </div>\n            </div>\n            <div class="muxfb-right-content muxfb-list" id="J_muxfb_list">\n                <div>loading...</div>\n            </div>\n            <div class="muxfb-successful">\n                <p><i class="muxfb-icon muxfb-icon-smile"></i></p>\n                <p class="muxfb-successful-thanks">\u8c22\u8c22\u60a8\u7684\u53cd\u9988</p>\n            </div>\n        '};r.prototype={consturctor:r,on:function(t,e){this.__listeners||(this.__listeners={}),this.__listeners[t]||(this.__listeners[t]=[]);var n=this.__listeners[t];return-1===n.indexOf(e)&&n.push(e),this},off:function(t,e){var n,i;return t?e?(i=a.indexOf(this.__listeners[t],e))>-1&&n.splice(i,1):delete this.__listeners[t]:delete this.__listeners,this},emit:function(t){if(this.__listeners){var e=this.__listeners[t],n=Array.prototype.slice.call(arguments,1)||[];return a.isArray(e)&&a.each(e,function(t){a.isFunction(t)&&t.apply(this,n)}),this}}},r.extend=function(t,e){var n,i=this;n=t&&a.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},a.extend(n,i,e);var s=function(){this.constructor=n};return s.prototype=i.prototype,n.prototype=new s,t&&a.extend(n.prototype,t),n.__super__=i.prototype,n.extend=r.extend,n};var d=Object.prototype.toString;Array.isArray||(Array.isArray=function(t){return"[object Array]"==d.call(t)}),Object.keys||(Object.keys=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e});var m=Array.prototype;m.indexOf||(m.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),m.forEach||(m.forEach=function(t){for(var e=0,n=this.length;n>e;e++)t(this[e],e)}),m.some||(m.some=function(t){for(var e=0,n=this.length;n>e;e++)if(t(this[e],e))return!0;return!1}),m.every||(m.every=function(t){for(var e=0,n=this.length;n>e;e++)if(!t(this[e],e))return!1;return!0}),m.map||(m.map=function(t){for(var e=[],n=0,i=this.length;i>n;n++)e[n]=t(this[n],n);return e}),m.reduce||(m.reduce=function(t,e){if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var n,i,r=this.length>>>0,s=!1;for(1<arguments.length&&(i=e,s=!0),n=0;r>n;++n)this.hasOwnProperty(n)&&(s?i=t(i,this[n],n,this):(i=this[n],s=!0));if(!s)throw new TypeError("Reduce of empty array with no initial value");return i});var p=String.prototype;p.trim||(p.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});var g=Function.prototype;g.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r});var b=function(){function n(t,e){return t.classList?t.classList.contains(e):t.className&&t.className.trim?t.className.trim().split(/\s+/).indexOf(e)>=0:void 0}function r(t,e){if(t.classList)t.classList.remove(e);else{for(var n=t.className.trim().split(/\s+/),i=n.length-1;i>=0;i--)n[i]==e&&n.splice(i,1);t.className=n.join(" ")}}function s(t,e){t.classList?t.classList.add(e):n(t,e)||(t.className+=" "+e)}function o(t,e){return u(t,e)}function u(t,e,n){var i;if(/^#[a-z]+$/i.test(t))return i=j.getElementById(t.slice(1)),n?i:[i];for(var r=e.getElementsByTagName("*"),s=[],o=0,a=r.length;a>o;o++)if(i=r[o],l(i,t,e)){if(n)return i;s.push(i)}return s}function l(t,e,n){var i=e.split(",");return i.some(function(e){return c(t,e,n)?!0:void 0})}function c(t,e,n){var i,r=e.replace(/>/g," $& ").trim().split(/\s+/).reverse();return r.every(function(e,r){if(0===r)return f(t,e)&&p(n,t);if(">"===e)return i=t,!0;if(i){var s=i.parentNode;return i=!1,t=t.parentNode,f(s,e)}for(t=t.parentNode;t&&!f(t,e);)t=t.parentNode;return!!t})}function f(t,e){for(var n,i=/[.#:][\w-]+|\[(.+?)(?:=(["']?)(.*?)\1)?]|^[a-z-]+/g;n=i.exec(e);){var r=n[0];if(!h(t,r))return!1}return!0}function h(t,e){if(!t)return!1;if(t.matches)return t.matches(e);var r=e.charAt(0);if("#"==r)return t.id===e.slice(1);if("."==r)return n(t,e.slice(1));if("["==r){var s=e.match(/^\[(.+?)(=(["']?)(.*?)\3)?]$/i),o=s[1],a=!!s[2],u=a?s[4]:i;if(!o)throw new Error("Invalid attribute selector: "+e);var l="class"===o?t.className:t.getAttribute(o);return u===i?null!==l:l===u}if(":"!=r)return t.tagName===e.toUpperCase();var c=e.slice(1);switch(c){case"first-child":return t.parentNode.firstElementChild||g(t.parentNode)===t}}function d(t,e){return!!t&&t.nodeType==e}function m(t,e){return t.tagName.toLowerCase()===e}function p(t,e){for(;e=e.parentNode;)if(e===t)return!0;return!1}function g(t){for(var e=t.childNodes,n=0,i=e.length;i>n;n++){var r=e[n];if(r.nodeType===M.ELEMENT_NODE)return r}return null}function b(t,e){return O.getComputedStyle?(e=a.dasherize(e),O.getComputedStyle(t).getPropertyValue(e)):t.currentStyle?(e=a.camelize(e),t.currentStyle[e]):void 0}function v(t,e,n){t.style[e]=y(n,e)}function y(t,e){return t?("width height top right bottom left".split(" ").indexOf(e)>=0&&!/[^-\.\d]/.test(t)&&(t+="px"),t):t}function x(t,e){e=e||j;var n=[];t&&(t.nodeType?n=[t]:"string"==typeof t?n=j.querySelectorAll?e.querySelectorAll(t):o(t,e):t&&(n="length"in t?t:[t]));for(var i=n.length,r=0;i>r;r++)this[r]=n[r];this.length=i}function E(t,e){return new x(t,e)}function _(){}function w(t){var e=t[P];return e||(e=t[P]=R++,F[e]={}),F[e]}function S(t){var e=t[P];if(e){delete F[e];try{delete t[P]}catch(n){t.removeAttribute&&t.removeAttribute(P)}}}function C(t){var n,i=e.createElement("div");return t="on"+t,n=t in i,n||(i.setAttribute(t,"return;"),n="function"==typeof i[t]),i=null,n}function T(n){function i(){return!0}function r(){return!1}if(!n||!n.stopPropagation){var s=n||t.event;n={};for(var o in s)n[o]=s[o];if(n.target||(n.target=n.srcElement||e),n.relatedTarget=n.fromElement===n.target?n.toElement:n.fromElement,n.preventDefault=function(){n.returnValue=!1,n.isDefaultPrevented=i},n.isDefaultPrevented=r,n.stopPropagation=function(){n.cancelBubble=!0,n.isPropagationStopped=i},n.isPropagationStopped=r,n.stopImmediatePropagation=function(){this.isImmediatePropagationStopped=i,this.stopPropagation()},n.isImmediatePropagationStopped=r,null!==n.clientX){var a=e.documentElement,u=e.body;n.pageX=n.clientX+(a&&a.scrollLeft||u&&u.scrollLeft||0)-(a&&a.clientLeft||u&&u.clientLeft||0),n.pageY=n.clientY+(a&&a.scrollTop||u&&u.scrollTop||0)-(a&&a.clientTop||u&&u.clientTop||0)}n.which=n.charCode||n.keyCode,null!==n.button&&(n.button=1&n.button?0:4&n.button?1:2&n.button?2:0)}return n}function A(t){function e(){return!1}return t.isDefaultPrevented=e,t.isPropagationStopped=e,t}function L(t,n){function i(t){for(var e in t)return!1;return!0}var r=w(t);0===r.handlers[n].length&&(delete r.handlers[n],(t.addEventListener||t.attachEvent)&&(e.removeEventListener?t.removeEventListener("focusin"===n?"focus":"focusout"===n?"blur":n,r.dispatcher,"focusin"===n||"focusout"===n):e.detachEvent&&t.detachEvent("on"+n,r.dispatcher))),i(r.handlers)&&(delete r.handlers,delete r.dispatcher),i(r)&&S(t)}function k(t,e,n,i){for(var r=e.relatedTarget;r&&r!=t;)try{r=r.parentNode}catch(s){break}r!=t&&i.call(t,n)}function N(t,e){var n=w(t),i=t.parentNode||t.ownerDocument;for(n.disabled=e;i;)n=w(i),"undefined"!=typeof n.disabled&&(n.disabled=e),i=i.parentNode||i.ownerDocument}{var O=this,j=O.document,M=O.Node||{ELEMENT_NODE:1,DOCUMENT_NODE:9};Object.prototype.toString}E.fn=x.prototype,E.fn.find=function(t){return this.length>0?new x(t,this[0]):new x},E.fn.next=function(t){for(var e=this[0];(e=e.nextSibling)&&(!d(e,1)||t&&!m(e,t)););return new x(e)},E.fn.each=function(t){for(var e=0,n=this.length;n>e;e++)t(this[e],e);return this},E.fn.map=function(t){for(var e=[],n=0,i=this.length;i>n;n++)e[n]=t(this[n],n);return e},E.fn.hasClass=function(t){return n(this[0],t)},E.fn.addClass=function(t){return this.each(function(e){s(e,t)})},E.fn.removeClass=function(t){return this.each(function(e){r(e,t)})},E.fn.toggleClass=function(t){return this.each(function(e){n(e,t)?r(e,t):s(e,t)})},E.fn.html=function(t){return"undefined"==typeof t?this[0].innerHTML:this.each(function(e){e.innerHTML=t})},E.fn.attr=function(t,e){return"undefined"==typeof e&&this.length>0?this[0].getAttribute(t):this.each(function(n){n.setAttribute(t,e)})},E.fn.hasAttr=function(t){if(this.length>0){var e=this[0];return e.hasAttribute?e.hasAttribute(t):null!==e.getAttribute(t)}},E.fn.removeAttr=function(t){return this.each(function(e){e.removeAttribute(t)})},E.fn.val=function(t){return"undefined"==typeof t?this.length>0?this[0].value:null:this.each(function(e){e.value=t})},E.fn.data=function(t,e){return"undefined"==typeof e&&this.length>0?a.cast(this[0].getAttribute("data-"+t)):this.each(function(n){n.setAttribute("data-"+t,e)})},E.fn.first=function(){return new x(this[0])},E.fn.last=function(){return new x(this[this.length-1])},E.fn.next=function(){var t=this[0];do t=t.nextSibling;while(t&&1!==t.nodeType);return new x(t)},E.fn.get=function(t){return new x(this[t])},E.fn.children=function(){if(this.length>0){for(var t=this[0],e=t.firstChild,n=[];e;)1==e.nodeType&&n.push(e),e=e.nextSibling;return new x(n)}return new x},E.fn.parent=function(t){var e=this[0],n=e.parentNode;if("undefined"==typeof t)return n&&new x(n);for(;n;){if(h(n,t))return new x(n);n=n.parentNode}},E.fn.show=function(){return this.each(function(t){t.style.display="block"})},E.fn.hide=function(){return this.each(function(t){t.style.display="none"})},["height","width"].forEach(function(t){function e(t){var e=parseInt(t,10);return isNaN(e)?0:e}var n="height"===t?["Top","Bottom"]:["Left","Right"],i=a.capitalize(t);E.fn[t]=function(){return Math.max(this[0]["offset"+i],e(this.css(t)))},E.fn["inner"+i]=function(){var i=this;return this[t]()+n.reduce(function(t,n){return t+e(i.css("padding"+n))},0)},E.fn["outer"+i]=function(t){var r=this,s=this["inner"+i]();return s+=n.reduce(function(t,n){return t+e(r.css("border"+n+"Width"))},0),t&&(s+=n.reduce(function(t,n){return t+e(r.css("margin"+n))},0)),s}}),E.fn.css=function(t,e){return"undefined"==typeof e&&"string"==typeof t&&this.length>0?b(this[0],t):this.each(function(n){if("undefined"==typeof e&&"object"==typeof t)for(var i in t)v(n,a.camelize(i),t[i]);else v(n,a.camelize(t),e)})},E.fn.prepend=function(t){return"string"==typeof t&&(t=e.createTextNode(t)),this.each(function(e){t instanceof x?t.each(function(t){e.insertBefore(t,e.firstChild)}):1===t.nodeType?e.insertBefore(t,e.firstChild):e.insertBefore(t,e.firstChild)})},E.fn.append=function(t){return"string"==typeof t&&(t=e.createTextNode(t)),this.each(function(e){t instanceof x?t.each(function(t){e.appendChild(t)}):e.appendChild(t)})},E.fn.appendTo=function(t){return t=new x(t),this.each(function(e){t.append(e)})},E.fn.clone=function(){return new x(this.map(function(t){return t.cloneNode(!0)}))},E.fn.remove=function(){return this.each(function(t){t.parentNode.removeChild(t)})},E.fn.position=function(){if(this.length>0){var t=this[0];return{left:t.offsetLeft,top:t.offsetTop}}},E.fn.offset=function(){if(this.length>0){var e,n=this[0],r={top:0,left:0},s=n&&n.ownerDocument;if(!s)return;return e=s.documentElement,typeof n.getBoundingClientRect!==i&&(r=n.getBoundingClientRect()),{top:r.top+t.pageYOffset-e.clientTop,left:r.left+t.pageXOffset-e.clientLeft}}};var F={},R=1,I=1,P="data"+(new Date).getTime();return _.on=function(t,n,i){if(/mouseenter|mouseleave/.test(n)&&!C("mouseenter")){var r={mouseenter:"mouseover",mouseleave:"mouseout"};return void _.on(t,r[n],function(t){k(this,t,r[n],i)})}var s=w(t);if(s.handlers||(s.handlers={}),s.handlers[n]||(s.handlers[n]=[]),i.guid||(i.guid=I++),s.handlers[n].push(i),s.dispatcher||(s.disabled=!1,s.dispatcher=function(e){if(!s.disabled){e=t.addEventListener||t.attachEvent?T(e):e,e.currentTarget=t;var n=s.handlers[e.type];if(n)for(var i=0;i<n.length;i++)n[i].call(t,e)}}),1==s.handlers[n].length){if(!t.addEventListener&&!t.attachEvent)return;e.addEventListener?t.addEventListener("focusin"===n?"focus":"focusout"===n?"blur":n,s.dispatcher,"focusin"===n||"focusout"===n):e.attachEvent&&t.attachEvent("on"+n,s.dispatcher)}},_.off=function(t,e,n){var i=w(t);if(i.handlers){var r=function(e){i.handlers[e]=[],L(t,e)};if(e){var s=i.handlers[e];if(s){if(!n)return void r(e);if(n.guid)for(var o=0;o<s.length;o++)s[o].guid===n.guid&&s.splice(o--,1);L(t,e)}}else for(var a in i.handlers)r(a)}},_.trigger=function(t,e){var n=w(t),i=t.parentNode||t.ownerDocument;"string"==typeof e&&(e={type:e,target:t}),e=t.addEventListener||t.attachEvent?T(e):A(e),n.dispatcher&&n.dispatcher.call(t,e),i&&!e.isPropagationStopped()?_.trigger(i,e):i||e.isDefaultPrevented()||e.target[e.type]&&(N(e.target,!0),e.target[e.type](),N(e.target,!1))},E.fn.on=function(t,e){return this.each(function(n){_.on(n,t,e)})},E.fn.off=function(t,e){return this.each(function(n){_.off(n,t,e)})},E.fn.trigger=function(t){return this.each(function(e){_.trigger(e,t)})},E.fn.animate=function(t,e,n,i){if(arguments.length<2)throw new Error("animate need have prop, speed arguments");return 2===arguments.length?i=a.isFunction(e)?e:function(){}:3===arguments.length&&(i=a.isFunction(e)?n:function(){},n="normal"),this.each(function(e){E(e).css(t)}),i(),this},E}(),v=0;t.Messenger=function(){function n(t,e){var n="";if(arguments.length<2?n="target error - target and name are both requied":"object"!=typeof t?n="target error - target itself must be window object":"string"!=typeof e&&(n="target error - target name must be string type"),n)throw new Error(n);this.target=t,this.name=e}function i(t,e){this.targets={},this.name=t,this.listenFunc=[],r=e||r,"string"!=typeof r&&(r=r.toString()),this.initListen()}var r="[PROJECT_NAME]",s="postMessage"in t;return n.prototype.send=s?function(t){this.target.postMessage(t,"*")}:function(e){var n=t.navigator[r+this.name];if("function"!=typeof n)throw new Error("target callback function is not defined");n(e,t)},i.prototype.addTarget=function(t,e){var i=new n(t,e);this.targets[e]=i},i.prototype.initListen=function(){var n=this,i=function(t){"object"==typeof t&&t.data&&(t=t.data);for(var e=0;e<n.listenFunc.length;e++)n.listenFunc[e](t)};s?"addEventListener"in e?t.addEventListener("message",i,!1):"attachEvent"in e&&t.attachEvent("onmessage",i):t.navigator[r+this.name]=i},i.prototype.listen=function(t){this.listenFunc.push(t)},i.prototype.clear=function(){this.listenFunc=[]},i.prototype.send=function(t){var e,n=this.targets;for(e in n)n.hasOwnProperty(e)&&n[e].send(t)},i}();var y=function(){function t(t){this.opts=a.extend({tpl:'    <div class="muxfb-dialog-panel">\n        <i class="muxfb-dialog-close"></i>\n        <div class="muxfb-dialog-content">\n        </div>\n    </div>\n    <div class="muxfb-dialog-mask"></div>\n'},t),this.init()}return r.extend({constructor:t,init:function(){this.render()},render:function(){this.elem=b(e.createElement(u)).addClass(l.CLASS_NAME).html(this.opts.tpl).hide(),this.panel=this.elem.find(l.PANEL_SELECTOR).css({width:this.opts.width||"auto",height:this.opts.height||"auto"}),this.content=this.elem.find(l.CONTENT_SELECTOR),this.mask=this.elem.find(l.MASK_SELECTOR),b(e.body).append(this.elem),this.bind()},bind:function(){var t=this;this.panel.on("click",function(e){var n=b(e.target);n.hasClass(l.CLOSE_CLASS_NAME)&&t.close()})},open:function(){var t=this,e=Array.prototype.slice.call(arguments);this.elem.show(),this.panel.animate(this._start(),function(){e.unshift("open"),t.emit.apply(t,e)})},close:function(){var t=this;this.panel.animate(this._end(),function(){t.elem.hide(),t.emit("close")})},destroy:function(){this.elem.off(),this.emit("destroy")},_start:function(){return{bottom:80,right:0}},_end:function(){return{bottom:80,right:-this.panel.width()}}})}(),x=function(){function t(t,e){this.elem=t,this.opts=a.extend({index:0,buttonSelector:".muxfb-tabs-bar li label",panelSelector:".muxfb-tabs-panel",currentClass:"current"},e),this.init()}return r.extend({constructor:t,init:function(){this.elem=b(this.elem),this.buttons=this.elem.find(this.opts.buttonSelector),this.panels=this.elem.find(this.opts.panelSelector),this.select(this.opts.index),this.bind()},bind:function(){this.buttons.on("click",a.bind(this.handle,this))},handle:function(t){this.select(a.indexOf(this.buttons,t.currentTarget))},select:function(t){this.buttons.removeClass(this.opts.currentClass),this.buttons.get(t).addClass(this.opts.currentClass),this.panels.hide(),this.panels.get(t).show(),this.index=t,this.emit("Tabs.select",{index:t})},destroy:function(){this.buttons.off("click")}})}(),E=function(){function t(t,e){this.elem=t,this.opts=a.extend({tpl:'    <label><%= label %></label>\n    <% for (var i = 0; i < level; i++ ) { %>\n    <span class="muxfb-star-unselected"></span>\n    <% } %>\n    <i class="muxfb-star-info"></i>\n',label:"\u8bc4\u5206",level:5,readme:["\u5931\u671b ~.~","\u4e0d\u6ee1 -.-",'\u4e00\u822c "."',"\u6ee1\u610f ^.^","\u60ca\u559c *.*"],selectedSelector:".muxfb-star-selected",unselectedSelector:".muxfb-star-unselected"},e),this.init()}return r.extend({constructor:t,value:-1,init:function(){this.elem=b(this.elem),this.render()},render:function(){this.elem.html(a.template(this.opts.tpl,this.opts)),this.stars=this.elem.find("span"),this.readme=this.elem.find("i"),this.bind()},bind:function(){this.stars.on("mouseover",a.bind(this.handleOver,this)).on("mouseout",a.bind(this.handleOut,this)).on("click",a.bind(this.handleClick,this))},handleOver:function(t){this.fill(a.indexOf(this.stars,t.currentTarget))},handleOut:function(){this.fill(this.value)},handleClick:function(t){this.fill(this.value=a.indexOf(this.stars,t.currentTarget))},fill:function(t){this.stars.each(function(e,n){e.className=t>=n?"muxfb-star-selected":"muxfb-star-unselected"}),this.readme.html(this.opts.readme[t]||"")},destroy:function(){this.stars.off()}})}(),_=function(){function t(t){this.elem=b(t),this.init()}return r.extend({constructor:t,init:function(){this.input=this.elem.find("input"),this.iframe=e.createElement("iframe"),this.iframe.name=c.IFRAME_NAME,this.iframe.id=c.IFRAME_NAME,this.iframe.style.display="none",this.form=this.elem.find("form")[0],this.form.action=f.UPLOAD_IMAGE,this.form.target=c.IFRAME_NAME,this.messenger=new Messenger("muxfb-parent","muxfb"),this.messenger.addTarget(this.iframe.contentWindow,c.IFRAME_NAME),b(e.body).append(this.iframe),this.bind()},bind:function(){this.input.on("change",a.bind(this.handle,this)),this.messenger.listen(a.bind(this.complete,this))},handle:function(t){t.target.value&&(this.emit("before"),this.form.submit())},complete:function(t){return t?t.message?this.emit("error",t):(this.data={url:t.image,filename:a.last(this.input[0].value.split("\\"))},void this.emit("success",this.data)):this.emit("error",{message:"\u672a\u77e5\u9519\u8bef"})},destroy:function(){this.off(),b(this.iframe).remove()}})}(),w=function(){function t(t,e){this.elem=b(t),this.images=[],this.opts=a.extend({tpl:'    <%= filename %><i class="muxfb-icon muxfb-icon-close" index="<%= index %>"></i>\n'},e),this.init()}return r.extend({constructor:t,init:function(){this.preview=this.elem.find(".muxfb-uploader-preview"),this.uploader=new _(this.elem[0]),this.bind()},bind:function(){var t=this;this.uploader.on("before",function(e){t.emit("before",e)}),this.uploader.on("error",function(e){t.emit("error",e)}),this.uploader.on("success",function(e){t.add(e)}),this.elem.on("click",function(e){var n=b(e.target);n.hasClass("muxfb-icon-close")&&t.remove(n)})},add:function(t){t.index=this.images.length,this.images.push(t);var n=e.createElement("li");n.innerHTML=a.template(this.opts.tpl,t),this.preview.append(n)},remove:function(t){var e=t.attr("index");t.parent().remove(),this.images.splice(e,1)},destroy:function(){this.images=[],this.elem.off(),this.uploader.destroy()}})}(),S={guideKey:"muxfb-has-showguide",nicknameKey:"muxfb-nickname",hasSubmitKey:"muxfb-hassubmit",maxSubmitStrLength:200,_get:function(e){return t.localStorage?t.localStorage.getItem(e)||"":""},_set:function(e,n){t.localStorage&&t.localStorage.setItem(e,n)},_getCookie:function(t){if(new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(t)){var n=new RegExp("(^| )"+t+"=([^;]*)(;|$)"),i=n.exec(e.cookie);if(i)return i[2]||null}return null},hasShowGuide:function(){return t.localStorage?this._get(this.guideKey):!0
},setGuideViewed:function(){this._set(this.guideKey,!0)},getCustomer:function(){var t=this._getCookie("cna");return t?t:this._get(this.nicknameKey)},setCustomer:function(t){this._set(this.nicknameKey,t)},getSubmitStr:function(){return this._get(this.hasSubmitKey)},setSubmitStr:function(t){var e=this.getSubmitStr();e.length>this.maxSubmitStrLength||(e=e.replace(t+",","")+t+",",this._set(this.hasSubmitKey,e))}},C=function(){var t=navigator.userAgent.indexOf("MSIE 8.0")>-1||navigator.userAgent.indexOf("MSIE 7.0")>-1||navigator.userAgent.indexOf("MSIE 6.0")>-1,n=r.extend({opts:{style:"http://g.tbcdn.cn/mm/fbsdk/1.0.0/theme/default/feedback.css",guide:!1},init:function(){this._inited=!0,this.data={},this.on("config.style",a.bind(this.setupStyle,this)),this.on("config.nickname",a.bind(this.setupNickname,this)),this.on("config.guide",a.bind(this.setupGuide,this)),this.on("config.forms",a.bind(this.setupForms,this)),this.config(this.opts),this.bind()},config:function(t,e){this._inited||this.init();var n=this;return a.isObject(t)?a.each(t,function(t,e){n.config(e,t)}):(this.opts[t]=e,void this.emit("config."+t,e))},bind:function(){var t=this;b(e.body).on("click",function(e){var n=b(e.target);return("muxfb-global-tip-close"===e.target.id||"muxfb-global-emitter"===e.target.id)&&t.removeGuide(),t.forms&&t.forms[e.target.id]?void t.openFeedbackPanel(t.forms[e.target.id]):n.hasClass("muxfb-form-submit")?void t.submit():void 0})},setupStyle:function(t){this._styleElem&&this._styleElem.remove(),this._styleElem=b(e.createElement("link")),this._styleElem.attr("rel","stylesheet"),this._styleElem.attr("type","text/css"),this._styleElem.attr("href",t),b(e.getElementsByTagName("head")[0]).append(this._styleElem)},setupNickname:function(){this.data.unreadCount=0;var t=b(".g-unread-em");t.length&&t.remove(),this.loadUnread()},setupGuide:function(){!S.hasShowGuide()&&this._globalEmitterElem&&this._globalEmitterElem.addClass("muxfb-global-showguide")},setupForms:function(t){if(a.isArray(t)){var n=this;this.forms={},a.each(t,function(t){n.forms[t.hook||"global"]=t.id}),this._globalEmitterElem&&(this._globalEmitterElem.off(),this._globalEmitterElem.remove()),this.forms.global&&(this._globalEmitterElem=e.createElement("div"),this._globalEmitterElem.id="muxfb-global-emitter",this._globalEmitterElem.className="muxfb-icon muxfb-icon-feedback muxfb-global-emitter",b(e.body).append(this._globalEmitterElem),this.forms["muxfb-global-emitter"]=this.forms.global,delete this.forms.global,this._globalEmitterElem=b(this._globalEmitterElem),this._globalEmitterElem.html(h.TIP),this._globalEmitterElem.on("mouseenter",function(){n._globalEmitterElem.addClass("muxfb-global-showtip")}),this._globalEmitterElem.on("mouseleave",function(){n._globalEmitterElem.removeClass("muxfb-global-showtip")}),this.opts.guide&&this.setupGuide()),this.loadUnread()}},openFeedbackPanel:function(e){var n=this;this.dialog||(this.dialog=new y,this.dialog.on("open",function(t){n.jsonpQuery(f.GET_FORM+t,function(t){n.renderFeedbackPanel(t)})}),this.dialog.on("close",function(){n.dialog.content.off(),t||n.uploader.destroy(),n.tabs.destroy(),n.leftTabs.destroy(),a.each(n.stars,function(t){a.each(t,function(t){t.destroy()})}),n.dialog.content.html(""),n.hasLoadedList=!1})),this.dialog.open(e)},renderFeedbackPanel:function(e){var n=this.dialog.content,i=this;this.data.form=e,e.notie8=!t,e.unreadCount=this.data.unreadCount||0,e.card&&1===e.card.length&&(e.title=e.card[0].title),n.html(a.template(h.FORM,e)),t||(this.uploader=new w(n.find(".muxfb-uploader")),this.uploader.on("error",function(t){n.find(".muxfb-form-message").html(t.message).show()}),this.uploader.on("before",function(){n.find(".muxfb-form-message").hide()})),this.leftTabs=new x(n,{buttonSelector:".muxfb-left-tab-wrap .muxfb-left-tab",panelSelector:".muxfb-right-content"}),this.leftTabs.on("Tabs.select",function(t){1!=t.index||i.hasLoadedList||i.loadFbList()}),this.tabs=new x(n.find(".muxfb-tabs"));var r=a.reduce(e.card,function(t,e){return t.concat(e.field)},[]);this.stars=a.map(n.find(".muxfb-tabs-panel"),function(t){return a.map(b(t).find(".muxfb-star"),function(t){return new E(t,{label:r.shift()})})}),this.bindQuestionSelect()},bindQuestionSelect:function(){var t=this;b(".muxfb-question-category").on("change",function(e){var n=b(e.currentTarget),i=t.tabs.panels.get(t.tabs.index);i.find(".muxfb-form-textarea").val(n.val())})},loadFbList:function(){function t(t){var n={feedbacks:t||[]},i=b(".g-unread-em");e.convertListData(n),e.dialog.content.find("#J_muxfb_list").html(a.template(h.LIST,n)),e.hasLoadedList=!0,e.data.unreadCount=0,i.length&&i.remove()}var e=this,n=f.GET_LIST,i=this.getCustomer(),r=this.getForm();i&&r?(n+="?customer="+i,n+="&form="+r,e.jsonpQuery(n,t)):t()},convertListData:function(t){t.allCount=t.feedbacks.length,t.unHandleCount=t.allCount;var e=function(t,e){var n=new Date(t);return[n.getFullYear(),n.getMonth()+1,n.getDate()].join(e)};a.each(t.feedbacks,function(n){n.message&&n.message.length>0&&t.unHandleCount--,n._createAt=e(n.createAt,"-")})},removeGuide:function(){this._globalEmitterElem.removeClass("muxfb-global-showtip"),this._globalEmitterElem.removeClass("muxfb-global-showguide"),S.setGuideViewed()},submit:function(){var e=this.dialog.content,n=e.find(".muxfb-form-submit");if(!n.hasClass("status-submiting")){var i,r={},s=f.SUBMIT_FORM,u=this.tabs.index,l=this.data.form.card[u],c=e.find(".muxfb-form-message"),h=this,d=h.tabs.panels.get(u),m=d.find(".muxfb-question-category");if(r.site=this.data.form.site.id,r.form=this.data.form.id,r.card=l.id,r.customer=this.getCustomer(),r.description=d.find(".muxfb-form-textarea").val(),r.grade=a.map(this.stars[u],function(t){return t.value+1}),l.enabledProblemTemplate&&(r.problemTemplateTitle=m[0].options[m[0].selectedIndex].text),r.image=t?[]:a.map(this.uploader.images,function(t){return t.url}),i=a.reduce(r.grade,function(t,e){return t+e},0),!i&&!r.description)return c.html("\u8bf7\u81f3\u5c11\u7ed9\u6211\u6253\u70b9\u51e0\u5206 \u6216 \u8bf4\u4e24\u53e5\u5427 ^.^").show();if(i&&r.grade.indexOf(0)>-1)return c.html("\u65e2\u7136\u5df2\u7ecf\u6253\u4e86\u5206\uff0c\u5c31\u6253\u5168\u4e86\u5427 ^.^").show();i||(r.grade=a.map(this.stars[u],function(){return 5})),r.image.length||delete r.image,r.url=location.href,c.hide(),n.addClass("status-submiting"),n.html("\u6b63\u5728\u63d0\u4ea4"),o(s+"?"+a.param(r),function(t,i){if(n.removeClass("status-submiting"),n.html("\u63d0\u4ea4"),t)return c.html("\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5").show();if(i.message&&!i.id)return c.html(i.message).show();var r=i.customer||i[0].customer;r&&S.setSubmitStr(r),r&&/^[\da-z]{8}-([\da-z]{4}-){3}[\da-z]{12}$/i.test(r)&&S.setCustomer(r),e.find(".muxfb-form").hide(),e.find(".muxfb-left-tab-wrap").hide(),e.parent(".muxfb-dialog-panel").css("paddingLeft","0"),e.find(".muxfb-successful").show(),setTimeout(function(){h.dialog.close(),e.parent(".muxfb-dialog-panel").css("paddingLeft","150px")},800),h.loadUnread()})}},hasHistorySubmit:function(){var t=this.getCustomer(),e=S.getSubmitStr();return-1!==e.indexOf(t)},loadUnread:function(){var t=this.getCustomer(),n=this.getForm(),i=this.hasHistorySubmit(),r=f.UN_READ,s=this;clearTimeout(this._loadUnreadTimer),t&&n&&i&&(r+="?customer="+t,r+="&form="+n,this.jsonpQuery(r,function(t){if(t&&t.count){var n=b(e.createElement("em"));n.addClass("g-unread-em"),n.addClass("muxfb-global-unread"),n.html(t.count),s._globalEmitterElem&&s._globalEmitterElem.append(n),s.data.unreadCount=t.count}s._loadUnreadTimer=setTimeout(function(){s.loadUnread()},9e5)}))},getForm:function(){var t=null;for(var e in this.forms){t=this.forms[e];break}return t},getCustomer:function(){return this.opts.nickname?this.opts.nickname:S.getCustomer()},jsonpQuery:function(t,e){var n=this;o(t,function(t,i){return t?n.dialog.content.html("\u51fa\u9519\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u5173\u95ed\u540e\u91cd\u8bd5\uff01"):i.message?n.dialog.content.html(i.message):void(e&&e(i))})}}),i=new n;return i.VERSION="1.0.0",i}();C.Dialog=y,C.Tabs=x,C.Uploader=_,C.Messenger=Messenger,C.Star=E,C.jsonp=o,C.jqLite=b,t[n]=C}(window,document,"Feedback");