KISSY.add("components/album_top_nav/index",function(a,b,c,d,e,f,g){var h,i=a.all,j=b.extend({bindUI:function(){var a=this;new g({"class":"backtop iconfont",text:"&#61534"}),a.bind()},components:function(){var a=new e({render:"#J_user_dropdown",width:137});a.addChild(new e.Item({content:'<a href="/profile/edit"><em class="iconfont">&#355</em>账户设置</a>'})),a.addChild(new e.Item({content:'<a href="/logout"><em class="iconfont">&#417</em>退出账户</a>'})),a.render(),i(".ks-submenu-arrow").html("&#402"),a.on("click",function(){a.set("highlightedItem",null)})},bind:function(){var b=this;i("body").on("click",function(a){if(h&&h[0]!==a.target&&!h.contains(a.target)){if(h.hasClass("user-dropdown")&&"block"==h.css("display")){var b=i("#J_avatar");b.hasClass("up")?b.removeClass("up"):b.addClass("up")}h.hide()}var c=i("#J_loginBox");c&&!c.contains(a.target)&&c.animate({top:"-179px"},.5,"backBoth")}),a.one("body")[0].addEventListener("click",function(a){if("-1"===window.userId)for(var c=a.target;"BODY"!=c.tagName;){if(c.getAttribute("data-login"))return a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.halt&&a.halt(),void b.showLogin();c=c.parentNode}},!0),i("#J_form_top").on("submit",function(b){""==a.trim(i("#q").val())&&(b.preventDefault(),f.alert("请先输入搜索关键字"))})},showProjectFonts:function(b){var c='<p>该文件已有{{count}}个icon</p><ul class="fonts_selected_list clear">{{#each icons}}<li><span class="src_iconfont"><svg version="1.1" id="图形" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="58" height="58" viewBox="0 0 58 58" enable-background="new 0 0 58.636 58.678" xml:space="preserve" data-tags="pic" style="margin-left:2px;margin-top:2px;"><path id="J_icon_svg" d="{{svg}}" transform="translate(16, 24) scale(1, -1) scale(0.025,0.025)"></path></svg></span><p class="code">{{name}}</p></li>{{/each}}</ul>',e=i(".font-project-icons");0==e.length&&(e=a.one('<div class="font-project-icons"></div>'),i(".car_bd").append(e)),a.io({url:"/api/v2/projects/"+b,type:"get",dataType:"json",headers:{"X-CSRF-Token":i('meta[name="csrf-token"]').attr("content")},success:function(b){b.icons?e.show().html(new d(c).render({count:b.icons.length,icons:b.icons})):a.log(b.message)},error:function(){a.log("请求发生错误！")}})},loadProjects:function(){var b='{{#each data}}<li data-ids="{{icons}}" data-font-id="{{id}}">{{name}}</li>{{/each}}',c='{{#each data}}<li data-font-id="{{id}}" title="{{name}}"><i class="iconfont J_arrow_down">&#462;</i> <i class="iconfont">&#246;</i> {{name}}</li>{{/each}}';a.io({url:"/api/v2/users/projects",type:"get",dataType:"json",headers:{"X-CSRF-Token":i('meta[name="csrf-token"]').attr("content")},success:function(e){if(e){var f=new d(b).render({data:e.projects}),g=new d(c).render({data:e.projects});a.one(".font-porject-lists").html(f),a.one("#font-porject-lists-new").html(g)}else a.log(e.message)},error:function(){a.log("请求发生错误！")}})},showLogin:function(){var a=i("#J_loginBox");a.animate({top:"0px"},.5,"backBoth")},toggleFn:function(a,b){a.dropdown||(a.dropdown=b),h&&h==a.dropdown?b.toggle():(b.show(),h&&h.hide()),h=a.dropdown}},{ATTRS:{},EVENTS:{"#J_car":{click:function(a){a.halt();var b=this,c=i("#J_user_car"),d=a.currentTarget;f.checkCarEmpty(),b.toggleFn(d,c),b.loadProjects()}},"#J_SearchIcon":{click:function(a){a.halt(),i(".ks-combobox-input")[0].focus()}},"#J_avatar":{click:function(a){a.halt();var b=this,c=i("#J_user_dropdown"),d=a.currentTarget;i("#J_avatar").hasClass("up")?i("#J_avatar").removeClass("up"):i("#J_avatar").addClass("up"),b.toggleFn(d,c)}},"#J_save_cdn":{click:function(a){a.halt();{var b=i(".font-cdn");a.currentTarget}i(".save_ct").hide(),b.show()}},"#J_font_back":{click:function(a){a.halt();var b=i(".btn-download"),c=a.currentTarget;i(c).parent().hide(),b.show()}},".font-project-more .dot-up":{click:function(a){a.halt();var b=a.currentTarget;i(b).parent().addClass(".font-project-more-down")}},".font-project-more .dot-down":{click:function(a){a.halt();var b=a.currentTarget;i(b).parent().removeClass(".font-project-more-down")}},".font-porject-lists li":{click:function(a){a.halt();var b=this,c=i(a.currentTarget),d=i("#J_font_project_name"),e=i(".delete-font-project"),f=i("#J_font_project_id");d.val(c.html()).attr("readonly",!0),e.css("display","inline-block"),c.parent(".font-project-more").removeClass("font-project-more-down"),f.val(c.attr("data-font-id")),b.showProjectFonts(c.attr("data-font-id"))}},"#font-porject-lists-new li":{click:function(a){a.halt();var b=i(a.currentTarget),c=b.attr("data-font-id");i("#J_save_cdn").fire("click"),i('.font-porject-lists li[data-font-id="'+c+'"]').fire("click")}},"#J_user_dropdown li":{mouseenter:function(a){var b=i(a.currentTarget);b.addClass("hover")},mouseleave:function(a){var b=i(a.currentTarget);b.removeClass("hover")}},".delete-font-project":{click:function(a){a.halt();var b=i(a.currentTarget),c=i("#J_font_project_name"),d=i("#J_font_project_id");i(".font-project-icons").html(""),c.val("").attr("readonly",!1),d.val("0"),b.hide()}},"#J_font_save":{click:function(a){a.halt();f.saveToCdn()}},"#J_nologin":{click:function(a){a.halt();var b=this;b.showLogin()}},".save_selection .ibtn.disabled":{click:function(a){a.halt();var b=i("#J_user_car"),c=a.currentTarget,d=this;d.toggleFn(c,b),i("#J_nologin").fire("click")}},"#J_fonts_selected_list li":{mouseover:function(a){var b=i(a.currentTarget);b.one(".delete").css("display","block")},mouseout:function(a){var b=i(a.currentTarget);b.one(".delete").css("display","none")}},"#J_delete_car":{click:function(b){b.stopPropagation(),i("#J_fonts_selected_list").all("li").each(function(){var b=this.one(".delete"),c=b.attr("data-iconid");this.animate({opacity:0},.5,"backOut",function(){a.one("#font_"+c+" .icon")&&a.one("#font_"+c+" .icon").removeClass("selected"),a.one("#font_"+c+" .shopcar")&&a.one("#font_"+c+" .shopcar").removeClass("selected")})}),setTimeout(function(){f.removeShoppingCarList(i("#J_fonts_selected_list"))},500)}},"#J_down_local":{click:function(){f.downloadIconsZip()}},"#J_down_local2":{click:function(){f.downloadIconsZip()}},".delete":{click:function(b){b.stopPropagation();var c=i(b.currentTarget),d=c.attr("data-iconid");c.parent("li").animate({opacity:0},.5,"backOut",function(){a.one("#font_"+d+" .icon")&&a.one("#font_"+d+" .icon").removeClass("selected"),a.one("#font_"+d+" .shopcar")&&a.one("#font_"+d+" .shopcar").removeClass("selected"),f.removeShoppingCar(c)})}},"#J_upload_icon":{click:function(a){a.stopPropagation(),a.halt(),this.showLogin()}},".logo":{click:function(a){a.stopPropagation(),location.href="/"}}}});return j},{requires:["brix/core/brick","combobox","xtemplate","menu","components/custom_helper/","components/gallery_backtop/index"]});